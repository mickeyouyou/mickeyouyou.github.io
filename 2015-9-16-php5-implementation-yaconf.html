<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <link rel="stylesheet" href="/css/main.css" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">
    
    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">
    <link rel="shortcut icon" href="/images/icon.png">

    
    <title>PHP5 implementation Of Yaconf</title>
</head>

<body>

<h3 id="PHP5_implementation_Of_Yaconf">PHP5 implementation Of Yaconf</h3><p>其他的扩展都是从低版本适配到高版本的PHP7适配，而这个库比较特殊，是因为在PHP7还没有普及的前提下，需要低于7的其他版本使用。</p>
<p>让扩展兼容PHP7，需要改动70%以上的代码；相反，从PHP7到PHP5，修改的地方也差不多是这么多。</p>
<p>这个工作正在进行，因为在忙最近公司扯淡的善后，会在完成之后更新本文。</p>
<h4 id="流程">流程</h4><p>直接加载目录</p>
<p>还需要对加载文件循环，做成键值对</p>
<p>对section读取处理成首索引返回</p>
<p>读取的时候构造键值对返回</p>
<h4 id="Case">Case</h4><p>两个配置文件都含有base节点，yaconf此时用分节的方式读取的时候应该显示？需要亲测一下。</p>
<h4 id="实现">实现</h4><p><strong>方法原型</strong></p>
<p><code>mixed Yaconf::get(string $name, mixed $default = NULL)</code><br>这个是获取一个配置, 名字是配置的名字, 一般来说如果你有一个ini文件叫做foo.ini, 那么$name使用foo的话就会获取到这个文件内的所有内容, 以数组形式返回. default是当配置不存在的时候返回的默认值.</p>
<p><code>bool Yaconf::has(string $name)</code><br>这个是检测一个配置是否存在.</p>
<p><strong>全局配置</strong></p>
<p><code>yaconf.directory</code><br>配置文件目录, 这个配置不能通过ini_set指定, 因为必须在PHP启动的时候就确定好.</p>
<p><code>yaconf.check_delay</code><br>多久(秒)检测一次文件变动, 如果是0就是不检测, 也就是说如果是0的时候, 文件变更只能通过重启PHP重新加载</p>
<p>全局变量的初始化</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* &#123;&#123;&#123; PHP_GINIT_FUNCTION</span><br><span class="line">*/</span></span><br><span class="line">PHP_GINIT_FUNCTION(yaconf)</span><br><span class="line">&#123;</span><br><span class="line">	yaconf_globals-&gt;directory = NULL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br></pre></td></tr></table></figure>
<h4 id="不同的数据类型的替换方案：">不同的数据类型的替换方案：</h4><p><strong>zend_string</strong></p>
<p>php7中的字符串结构：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> _zend_string &#123;</span><br><span class="line">	zend_refcounted_h gc;</span><br><span class="line">	zend_ulong        h;                <span class="comment">/* hash value */</span></span><br><span class="line">	<span class="keyword">size_t</span>            len;</span><br><span class="line">	<span class="keyword">char</span>              val[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>PHP5中的string : <code>char *name = NULL</code></p>
<p><strong>IS_ARRAY_IMMUTABLE</strong><br>在PHP7中数据分为两种类型，一种常规数组，一种不变数组。</p>
<p>兼容方案：<code>IS_ARRAY</code></p>
<p>CHANGE<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GC_FLAGS(ht) |= IS_ARRAY_IMMUTABLE;</span><br></pre></td></tr></table></figure></p>
<p>TO<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GC_G(ht) |= IS_ARRAY;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/* zval.u1.v.type_flags */&#10;281#define IS_TYPE_CONSTANT            (1&#60;&#60;0)&#10;282#define IS_TYPE_REFCOUNTED          (1&#60;&#60;1)&#10;283#define IS_TYPE_COLLECTABLE         (1&#60;&#60;2)&#10;284#define IS_TYPE_COPYABLE            (1&#60;&#60;3)&#10;285#define IS_TYPE_IMMUTABLE           (1&#60;&#60;4)</span><br></pre></td></tr></table></figure>
<h4 id="版本兼容">版本兼容</h4><p>需要考虑的版本兼容的问题，是从主仓库检出代码，然后开出当前php版本对应分支进行开发的。</p>
<h4 id="需要从头解决的问题">需要从头解决的问题</h4><p>开发基于php-5.4.45，在编译完php之后，检出yaconf针对php7的代码后直接编译，会有很多错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/vagrant/php-5.4.45/ext/yaconf/php_yaconf.h:69: &#38169;&#35823;&#65306;expected &#8216;)&#8217; before &#8216;*&#8217; token&#10;/vagrant/php-5.4.45/ext/yaconf/php_yaconf.h:70: &#38169;&#35823;&#65306;expected &#8216;)&#8217; before &#8216;*&#8217; token&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:38: &#38169;&#35823;&#65306;expected specifier-qualifier-list before &#8216;zend_string&#8217;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;php_yaconf_hash_init&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:92: &#38169;&#35823;&#65306;&#8216;IS_ARRAY_IMMUTABLE&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:92: &#38169;&#35823;&#65306;(&#21363;&#20351;&#22312;&#19968;&#20010;&#20989;&#25968;&#20869;&#22810;&#27425;&#20986;&#29616;&#65292;&#27599;&#20010;&#26410;&#22768;&#26126;&#30340;&#26631;&#35782;&#31526;&#22312;&#20854;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:92: &#38169;&#35823;&#65306;&#25152;&#22312;&#30340;&#20989;&#25968;&#20869;&#20063;&#21482;&#25253;&#21578;&#19968;&#27425;&#12290;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:94: &#38169;&#35823;&#65306;&#8216;IS_TYPE_IMMUTABLE&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;php_yaconf_hash_destroy&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:99: &#38169;&#35823;&#65306;&#8216;zend_string&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:99: &#38169;&#35823;&#65306;&#8216;key&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:102: &#38169;&#35823;&#65306;&#8216;HashTable&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;u&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:102: &#38169;&#35823;&#65306;&#8216;HASH_FLAG_INITIALIZED&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:103: &#38169;&#35823;&#65306;expected &#8216;;&#8217; before &#8216;&#123;&#8217; token&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:117: &#35686;&#21578;&#65306;&#20256;&#36882;&#8216;free&#8217;&#30340;&#31532; 1 &#20010;&#21442;&#25968;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/usr/include/stdlib.h:488: &#38468;&#27880;&#65306;&#38656;&#35201;&#31867;&#22411;&#8216;void *&#8217;&#65292;&#20294;&#23454;&#21442;&#30340;&#31867;&#22411;&#20026;&#8216;int&#8217;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;php_yaconf_hash_copy&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:123: &#38169;&#35823;&#65306;&#8216;zend_string&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:123: &#38169;&#35823;&#65306;&#8216;key&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:124: &#38169;&#35823;&#65306;&#8216;zend_long&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:124: &#38169;&#35823;&#65306;expected &#8216;;&#8217; before &#8216;idx&#8217;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:127: &#38169;&#35823;&#65306;&#8216;idx&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:127: &#38169;&#35823;&#65306;expected &#8216;;&#8217; before &#8216;&#123;&#8217; token&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:132:43: &#38169;&#35823;&#65306;&#23439;&#8220;zend_hash_index_update&#8221;&#38656;&#35201; 5 &#20010;&#21442;&#25968;&#65292;&#20294;&#21482;&#32473;&#20986;&#20102; 3 &#20010;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;php_yaconf_zval_persistent&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:142: &#38169;&#35823;&#65306;&#8216;zend_string&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:142: &#38169;&#35823;&#65306;&#8216;str&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:143: &#38169;&#35823;&#65306;&#8216;IS_STR_INTERNED&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:143: &#38169;&#35823;&#65306;&#8216;IS_STR_PERMANENT&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:155: &#38169;&#35823;&#65306;&#8216;_IS_BOOL&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;php_yaconf_simple_parser_cb&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:185: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:188: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:196: &#35686;&#21578;&#65306;&#20256;&#36882;&#8216;free&#8217;&#30340;&#31532; 1 &#20010;&#21442;&#25968;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/usr/include/stdlib.h:488: &#38468;&#27880;&#65306;&#38656;&#35201;&#31867;&#22411;&#8216;void *&#8217;&#65292;&#20294;&#23454;&#21442;&#30340;&#31867;&#22411;&#20026;&#8216;int&#8217;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:199: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:202: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:207: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:217: &#38169;&#35823;&#65306;&#8216;zend_long&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:217: &#38169;&#35823;&#65306;expected &#8216;;&#8217; before &#8216;idx&#8217;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:218: &#38169;&#35823;&#65306;&#8216;idx&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:218: &#38169;&#35823;&#65306;&#25552;&#20379;&#32473;&#20989;&#25968;&#8216;zend_hash_index_find&#8217;&#30340;&#23454;&#21442;&#22826;&#23569;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:220:61: &#38169;&#35823;&#65306;&#23439;&#8220;zend_hash_index_update&#8221;&#38656;&#35201; 5 &#20010;&#21442;&#25968;&#65292;&#20294;&#21482;&#32473;&#20986;&#20102; 3 &#20010;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:220: &#38169;&#35823;&#65306;&#8216;zend_hash_index_update&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:236: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:238: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:244: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:246: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;php_yaconf_ini_parser_cb&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:303: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:315: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#25991;&#20214;&#23618;&#65306;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:338: &#38169;&#35823;&#65306;expected &#8216;)&#8217; before &#8216;*&#8217; token&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:370: &#38169;&#35823;&#65306;expected &#8216;)&#8217; before &#8216;*&#8217; token&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;zim_yaconf_get&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:381: &#38169;&#35823;&#65306;&#8216;zend_string&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:381: &#38169;&#35823;&#65306;&#8216;name&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;zim_yaconf_has&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:403: &#38169;&#35823;&#65306;&#8216;zend_string&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:403: &#38169;&#35823;&#65306;&#8216;name&#8217;&#26410;&#22768;&#26126;(&#22312;&#27492;&#20989;&#25968;&#20869;&#31532;&#19968;&#27425;&#20351;&#29992;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;zm_startup_yaconf&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:446: &#38169;&#35823;&#65306;&#21464;&#37327;&#8216;dir_sb&#8217;&#26377;&#21021;&#22987;&#20540;&#35774;&#23450;&#20294;&#31867;&#22411;&#19981;&#23436;&#20840;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:446: &#35686;&#21578;&#65306;&#32467;&#26500;&#21021;&#22987;&#20540;&#35774;&#23450;&#39033;&#20013;&#26377;&#22810;&#20313;&#20803;&#32032;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:446: &#35686;&#21578;&#65306;(&#22312;&#8216;dir_sb&#8217;&#30340;&#21021;&#22987;&#21270;&#38468;&#36817;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:446: &#38169;&#35823;&#65306;&#8216;dir_sb&#8217;&#30340;&#23384;&#20648;&#22823;&#23567;&#26410;&#30693;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:452: &#38169;&#35823;&#65306;&#25552;&#20379;&#32473;&#20989;&#25968;&#8216;zend_register_internal_class_ex&#8217;&#30340;&#23454;&#21442;&#22826;&#23569;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:470: &#38169;&#35823;&#65306;&#8216;sb&#8217;&#30340;&#23384;&#20648;&#22823;&#23567;&#26410;&#30693;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:509: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;filename&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:510: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;mtime&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:511: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;filename&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;zm_activate_yaconf&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:541: &#38169;&#35823;&#65306;&#21464;&#37327;&#8216;dir_sb&#8217;&#26377;&#21021;&#22987;&#20540;&#35774;&#23450;&#20294;&#31867;&#22411;&#19981;&#23436;&#20840;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:541: &#35686;&#21578;&#65306;&#32467;&#26500;&#21021;&#22987;&#20540;&#35774;&#23450;&#39033;&#20013;&#26377;&#22810;&#20313;&#20803;&#32032;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:541: &#35686;&#21578;&#65306;(&#22312;&#8216;dir_sb&#8217;&#30340;&#21021;&#22987;&#21270;&#38468;&#36817;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:541: &#38169;&#35823;&#65306;&#8216;dir_sb&#8217;&#30340;&#23384;&#20648;&#22823;&#23567;&#26410;&#30693;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:558: &#38169;&#35823;&#65306;&#8216;sb&#8217;&#30340;&#23384;&#20648;&#22823;&#23567;&#26410;&#30693;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:577: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;mtime&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:601: &#35686;&#21578;&#65306;&#36171;&#20540;&#26102;&#23558;&#25972;&#25968;&#36171;&#32473;&#25351;&#38024;&#65292;&#26410;&#20316;&#31867;&#22411;&#36716;&#25442;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:610: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;mtime&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:612: &#35686;&#21578;&#65306;&#32467;&#26500;&#21021;&#22987;&#20540;&#35774;&#23450;&#39033;&#20013;&#26377;&#22810;&#20313;&#20803;&#32032;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:612: &#35686;&#21578;&#65306;(&#22312;&#8216;n&#8217;&#30340;&#21021;&#22987;&#21270;&#38468;&#36817;)&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:613: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;filename&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:614: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;mtime&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:615: &#38169;&#35823;&#65306;&#8216;yaconf_filenode&#8217;&#27809;&#26377;&#21517;&#20026;&#8216;filename&#8217;&#30340;&#25104;&#21592;&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c: &#22312;&#20989;&#25968;&#8216;zm_info_yaconf&#8217;&#20013;:&#10;/vagrant/php-5.4.45/ext/yaconf/yaconf.c:666: &#38169;&#35823;&#65306;expected &#8216;;&#8217; before &#8216;&#123;&#8217; token&#10;make: *** [yaconf.lo] &#38169;&#35823; 1</span><br></pre></td></tr></table></figure></p>
<p>这些基本上就是需要解决的版本兼容的问题。</p>
<h4 id="参考">参考</h4><p><a href="http://www.laruence.com/2015/06/12/3051.html" target="_blank" rel="external">Yaconf – 一个高性能的配置管理扩展</a></p>
<p><a href="http://my.oschina.net/jackin/blog/160664" target="_blank" rel="external">YAF分析（一）</a></p>
<p><a href="http://www.infoq.com/cn/presentations/php7-new-engine-for-good-old-train" target="_blank" rel="external">PHP7 - New engine for good old train</a></p>
<p><a href="https://wiki.php.net/phpng-upgrading" target="_blank" rel="external">Upgrading PHP extensions from PHP5 to NG</a></p>
<p><a href="https://wiki.php.net/phpng-int" target="_blank" rel="external">PHPNG Implementation Details</a></p>
<p><a href="http://blog.csdn.net/phpkernel/article/details/5734743" target="_blank" rel="external">PHP新的垃圾回收机制:Zend GC详解</a></p>
<p><a href="http://blog.csdn.net/heiyeshuwu/article/details/44259865" target="_blank" rel="external">PHP 7内核之HashTable实现</a></p>
<p><a href="http://blog.csdn.net/heiyeshuwu/article/details/44267021" target="_blank" rel="external">PHP扩展开发进阶</a></p>


<!--<a href="http://yoursite.com/2015-9-16-php5-implementation-yaconf.html#disqus_thread" class="article-comment-link">Comments</a>-->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = mickeyouyou; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=1254090228&web_id=1254090228" language="JavaScript"></script>script>
</div>







</body>
</html>
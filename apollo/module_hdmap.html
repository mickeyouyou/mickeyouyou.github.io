<html>
<head>
	
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Apollo 高精地图解析</title>
	<meta name="keywords" content="fzb.me,冯宗宝,冯宗宝的blog" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css" />
    
        <script src="/js/util.js"></script>
        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"/><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</head>

<body>


<!-- hexo-inject:begin --><!-- hexo-inject:end --><h2 class="title">Apollo 高精地图解析</h2>
<!---
<div style="text-align:center;margin-top: -10px;">
<div class="article-category">
发表于2018年2月28日




 </div>
--->
</div>

<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Apollo高精地图规范"><span class="toc-text"><a href="#Apollo&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x89C4;&#x8303;" class="headerlink" title="Apollo&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x89C4;&#x8303;"></a>Apollo&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x89C4;&#x8303;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#格式"><span class="toc-text"><a href="#&#x683C;&#x5F0F;" class="headerlink" title="&#x683C;&#x5F0F;"></a>&#x683C;&#x5F0F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#坐标"><span class="toc-text"><a href="#&#x5750;&#x6807;" class="headerlink" title="&#x5750;&#x6807;"></a>&#x5750;&#x6807;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#车道"><span class="toc-text"><a href="#&#x8F66;&#x9053;" class="headerlink" title="&#x8F66;&#x9053;"></a>&#x8F66;&#x9053;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#路口区域（juction）"><span class="toc-text"><a href="#&#x8DEF;&#x53E3;&#x533A;&#x57DF;&#xFF08;juction&#xFF09;" class="headerlink" title="&#x8DEF;&#x53E3;&#x533A;&#x57DF;&#xFF08;juction&#xFF09;"></a>&#x8DEF;&#x53E3;&#x533A;&#x57DF;&#xFF08;juction&#xFF09;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#高精地图在Apollo的存在形式"><span class="toc-text"><a href="#&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x5728;Apollo&#x7684;&#x5B58;&#x5728;&#x5F62;&#x5F0F;" class="headerlink" title="&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x5728;Apollo&#x7684;&#x5B58;&#x5728;&#x5F62;&#x5F0F;"></a>&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x5728;Apollo&#x7684;&#x5B58;&#x5728;&#x5F62;&#x5F0F;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#base-map-routing-map-和-sim-map之间的差异"><span class="toc-text"><a href="#base-map-routing-map-&#x548C;-sim-map&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;" class="headerlink" title="base_map, routing_map &#x548C; sim_map&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;"></a><strong><code>base_map</code>, <code>routing_map</code> &#x548C; <code>sim_map</code>&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;</strong></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML解析为Proto"><span class="toc-text"><a href="#XML&#x89E3;&#x6790;&#x4E3A;Proto" class="headerlink" title="XML&#x89E3;&#x6790;&#x4E3A;Proto"></a>XML&#x89E3;&#x6790;&#x4E3A;Proto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统内格式"><span class="toc-text"><a href="#&#x7CFB;&#x7EDF;&#x5185;&#x683C;&#x5F0F;" class="headerlink" title="&#x7CFB;&#x7EDF;&#x5185;&#x683C;&#x5F0F;"></a>&#x7CFB;&#x7EDF;&#x5185;&#x683C;&#x5F0F;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取高精地图元素"><span class="toc-text"><a href="#&#x83B7;&#x53D6;&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x5143;&#x7D20;" class="headerlink" title="&#x83B7;&#x53D6;&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x5143;&#x7D20;"></a>&#x83B7;&#x53D6;&#x9AD8;&#x7CBE;&#x5730;&#x56FE;&#x5143;&#x7D20;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#对地图的操作方法"><span class="toc-text"><a href="#&#x5BF9;&#x5730;&#x56FE;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;" class="headerlink" title="&#x5BF9;&#x5730;&#x56FE;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;"></a>&#x5BF9;&#x5730;&#x56FE;&#x7684;&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#获取元素实例"><span class="toc-text"><a href="#&#x83B7;&#x53D6;&#x5143;&#x7D20;&#x5B9E;&#x4F8B;" class="headerlink" title="&#x83B7;&#x53D6;&#x5143;&#x7D20;&#x5B9E;&#x4F8B;"></a>&#x83B7;&#x53D6;&#x5143;&#x7D20;&#x5B9E;&#x4F8B;</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用其他地图"><span class="toc-text"><a href="#&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x5730;&#x56FE;" class="headerlink" title="&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x5730;&#x56FE;"></a>&#x4F7F;&#x7528;&#x5176;&#x4ED6;&#x5730;&#x56FE;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-text"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</span></a></li></ol>
<p>关于Apollo高精地图，开发者有很多关心的问题。这篇文章会基于目前Apollo开放的地图数据部分，解析高精地图的数据格式。</p>
<p><strong>Apollo地图格式对OpenDRIVE都有哪些改动，改动的原因或初衷是什么，改动有什么优势？来自开发者@杨德刚</strong></p>
<p>OpenDRIVE本身设计面向的应用是仿真器，自动驾驶需要更多的信息OpenDRIVE并没有完全提供，所以我们对OpenDRIVE的标准做了部分改动和扩展。</p>
<p>主要改动和扩展了以下几个方面：<strong>一是地图元素形状的表述方式。以车道边界为例，标准OpenDRIVE采用基于Reference Line的曲线方程和偏移的方式来表达边界形状，而Apollo OpenDrive采用绝对坐标序列的方式描述边界形状；</strong>二是元素类型的扩展。例如新增了对于禁停区、人行横道、减速带等元素的独立描述；三是扩展了对于元素之间相互关系的描述。比如新增了junction与junction内元素的关联关系等；除此之外还有一些配合无人驾驶算法的扩展，比如增加了车道中心线到真实道路边界的距离、停止线与红绿灯的关联关系等。改动和扩展后的规格在实现上更加的简单，同时也兼顾了无人驾驶的应用需求。</p>
<h2 id="Apollo高精地图规范"><a href="#Apollo高精地图规范" class="headerlink" title="Apollo高精地图规范"></a>Apollo高精地图规范</h2><h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p>百度高精地图数据格式采用（XML）文件格式的数据组织方式，是基于国际通用的OpenDrive规范，并根据百度自动驾驶业务需求拓展修改而成。</p>
<p>Apollo高精地图文件的整体结构如下所示：</p>
<p><div id="flowchart-0" class="flow-chart"></div></p>
<h3 id="坐标"><a href="#坐标" class="headerlink" title="坐标"></a>坐标</h3><p>百度高精地图坐标采用WGS84经纬度坐标表示。WGS84为一种大地坐标系，也是目前广泛使用的GPS全球卫星定位系统使用的坐标系。</p>
<h3 id="车道"><a href="#车道" class="headerlink" title="车道"></a>车道</h3><p><strong>道路的reference line 存储在ID为0的车道中，其他车道只存储当前车道的一个边界。例如，reference line右侧的车道只存储车道的右侧边界。</strong></p>
<p><img src="http://7tsys1.com1.z0.glb.clouddn.com/WechatIMG145.jpeg" width="79%"><br>车道 ID 的命名规则:</p>
<ul>
<li>lane section 内唯一</li>
<li>数值连续的</li>
<li>reference line 所在 lane 的 ID 为 0</li>
<li>reference line 左侧 lane 的 ID 向左侧依次递增 (正t轴方向) </li>
<li>reference line 右侧 lane 的 ID 向右侧依次递减(负 t 轴方向) </li>
<li>reference line 必须定义在<code>&lt;center&gt;</code>节点内</li>
</ul>
<p>车道总数目没有限制。Reference line 自身必须为 Lane 0。</p>
<h3 id="路口区域（juction）"><a href="#路口区域（juction）" class="headerlink" title="路口区域（juction）"></a>路口区域（juction）</h3><p>基本的原理比较简单，路口区域用junction结构表达。在Junction内，incoming Road通过Connecting Roads与out-going道路相连。下图展示了一个比较复杂的路口：</p>
<p><img src="http://7tsys1.com1.z0.glb.clouddn.com/WechatIMG146.jpeg" width="79%"></p>
<h2 id="高精地图在Apollo的存在形式"><a href="#高精地图在Apollo的存在形式" class="headerlink" title="高精地图在Apollo的存在形式"></a>高精地图在Apollo的存在形式</h2><p>在最新的Docker镜像中，Apollo在启动时，会默认挂载以下所有地图：</p>
<ul>
<li>map_volume-sunnyvale_big_loop-latest</li>
<li>map_volume-sunnyvale_loop-latest</li>
</ul>
<p><img src="http://7tsys1.com1.z0.glb.clouddn.com/background.jpg" width="99%" alt="sunnyvale big loop"></p>
<p align="center">sunnyvale区域地图</p>


<p>一段道路的相关高精度地图可以放置在如下结构的目录中：<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sunnyvale_big_loop</span><br><span class="line">├── background.jpg</span><br><span class="line">├── background.png</span><br><span class="line">├── base_map.bin</span><br><span class="line">├── base_map.lb1</span><br><span class="line">├── base_map.txt</span><br><span class="line">├── base_map.xml               <span class="comment"># Defined by FLAGS_base_map_filename</span></span><br><span class="line">├── default_end_way_point.txt  <span class="comment"># Defined by FLAGS_end_way_point_filename</span></span><br><span class="line">├── grid_map</span><br><span class="line">├── local_map</span><br><span class="line">├── map.json</span><br><span class="line">├── routing_map.bin            <span class="comment"># Defined by FLAGS_routing_map_filename</span></span><br><span class="line">├── routing_map.txt</span><br><span class="line">├── sim_map.bin                <span class="comment"># Defined by FLAGS_sim_map_filename</span></span><br><span class="line">├── sim_map.txt</span><br><span class="line">└── speed_control.pb.txt</span><br></pre></td></tr></table></figure></p>
<p>可以将可用地图文件名指定为备选列表：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--base_map_filename=&quot;base.xml|base.bin|base.txt&quot;</span><br></pre></td></tr></table></figure></p>
<p>然后Apollo会找到第一个可用的文件加载。一般来说，按照以下扩展顺序加载：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x.xml  # An OpenDrive formatted map.</span><br><span class="line">x.bin  # A binary pb map.</span><br><span class="line">x.txt  # A text pb map.</span><br></pre></td></tr></table></figure>
<h3 id="base-map-routing-map-和-sim-map之间的差异"><a href="#base-map-routing-map-和-sim-map之间的差异" class="headerlink" title="base_map, routing_map 和 sim_map之间的差异"></a><strong><code>base_map</code>, <code>routing_map</code> 和 <code>sim_map</code>之间的差异</strong></h3><ul>
<li><p><code>base_map</code> 是最完整的地图，包含所有道路和车道几何形状和标识。其他版本的地图均基于base_map生成。</p>
</li>
<li><p><code>routing_map</code> 包含<code>base_map</code>中车道的拓扑结构，可以有以下命令生成：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dir_name=modules/map/data/demo # example map directory</span><br><span class="line">./scripts/generate_routing_topo_graph.sh --map_dir $&#123;dir_name&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>sim_map</code>是一个适用于Dreamview视觉可视化，基于<code>base_map</code>的轻量版本。减少了数据密度，以获得更好的运行时性能。可以由以下命令生成：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dir_name=modules/map/data/demo # example map directory</span><br><span class="line">bazel-bin/modules/map/tools/sim_map_generator --map_dir=$&#123;dir_name&#125; --output_dir=$&#123;dir_name&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>高精地图在Apollo中的流转形式</p>
<p>那接下来我们就看下从XML解析到proto的过程。</p>
<h3 id="XML解析为Proto"><a href="#XML解析为Proto" class="headerlink" title="XML解析为Proto"></a>XML解析为Proto</h3><p><div id="flowchart-1" class="flow-chart"></div><br><strong>TODO 高精度地图从XML格式到PROTO格式的变换和最终的形式。</strong></p>
<h3 id="系统内格式"><a href="#系统内格式" class="headerlink" title="系统内格式"></a>系统内格式</h3><p>不管原始数据格式为什么，在Apollo内部的数据地图的格式为proto。以下为Apollo高精地图的对象定义：<br><figure class="highlight protobuf"><figcaption><span>modules/map/proto/map.proto</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// This message defines how we project the ellipsoidal Earth surface to a plane.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Projection</span> </span>&#123;</span><br><span class="line">  <span class="comment">// PROJ.4 setting:</span></span><br><span class="line">  <span class="comment">// "+proj=tmerc +lat_0=&#123;origin.lat&#125; +lon_0=&#123;origin.lon&#125; +k=&#123;scale_factor&#125; +ellps=WGS84 +no_defs"</span></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">string</span> proj = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Header</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bytes</span> version = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bytes</span> date = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">optional</span> Projection projection = <span class="number">3</span>;<span class="comment">//坐标系转换</span></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bytes</span> district = <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bytes</span> generation = <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bytes</span> rev_major = <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bytes</span> rev_minor = <span class="number">7</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> left = <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> top = <span class="number">9</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> right = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> bottom = <span class="number">11</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bytes</span> vendor = <span class="number">12</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Map</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Header header = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">repeated</span> Crosswalk crosswalk = <span class="number">2</span>;<span class="comment">// 人行道</span></span><br><span class="line">  <span class="keyword">repeated</span> Junction junction = <span class="number">3</span>;<span class="comment">//路口区域</span></span><br><span class="line">  <span class="keyword">repeated</span> Lane lane = <span class="number">4</span>;<span class="comment">//车道</span></span><br><span class="line">  <span class="keyword">repeated</span> StopSign stop_sign = <span class="number">5</span>;<span class="comment">//停止线</span></span><br><span class="line">  <span class="keyword">repeated</span> Signal signal = <span class="number">6</span>;<span class="comment">//信号灯</span></span><br><span class="line">  <span class="keyword">repeated</span> YieldSign yield = <span class="number">7</span>;<span class="comment">//让路标志</span></span><br><span class="line">  <span class="keyword">repeated</span> Overlap overlap = <span class="number">8</span>;<span class="comment">//重叠区域</span></span><br><span class="line">  <span class="keyword">repeated</span> ClearArea clear_area = <span class="number">9</span>;<span class="comment">//禁停区域</span></span><br><span class="line">  <span class="keyword">repeated</span> SpeedBump speed_bump = <span class="number">10</span>;<span class="comment">//减速带</span></span><br><span class="line">  <span class="keyword">repeated</span> Road road = <span class="number">11</span>;<span class="comment">//道路</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其中重点介绍车道与路口部分。</p>
<p>如前文所述，Apollo高精度地图OpenDrive采用绝对坐标序列的方式描述边界形状，依次为基础生成直线或类似直线的对象：<br><figure class="highlight protobuf"><figcaption><span>modules/map/proto/map_geometry.proto</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// Polygon, not necessary convex.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Polygon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">repeated</span> apollo.common.PointENU point = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Straight line segment.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">LineSegment</span> </span>&#123;</span><br><span class="line">  <span class="keyword">repeated</span> apollo.common.PointENU point = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generalization of a line.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">CurveSegment</span> </span>&#123;</span><br><span class="line">  oneof curve_type &#123;</span><br><span class="line">    LineSegment line_segment = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> s = <span class="number">6</span>;  <span class="comment">// start position (s-coordinate)</span></span><br><span class="line">  <span class="keyword">optional</span> apollo.common.PointENU start_position = <span class="number">7</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> heading = <span class="number">8</span>; <span class="comment">// start orientation</span></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> length = <span class="number">9</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// An object similar to a line but that need not be straight.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Curve</span> </span>&#123;</span><br><span class="line">  <span class="keyword">repeated</span> CurveSegment segment = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>道路Road<br><figure class="highlight protobuf"><figcaption><span>modules/map/proto/mao_road.proto</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">BoundaryEdge</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Curve curve = <span class="number">1</span>;</span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">Type</span> </span>&#123;</span><br><span class="line">    UNKNOWN = <span class="number">0</span>;</span><br><span class="line">    NORMAL = <span class="number">1</span>;</span><br><span class="line">    LEFT_BOUNDARY = <span class="number">2</span>;</span><br><span class="line">    RIGHT_BOUNDARY = <span class="number">3</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">optional</span> Type type = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">BoundaryPolygon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">repeated</span> BoundaryEdge edge = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// boundary with holes</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">RoadBoundary</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> BoundaryPolygon outer_polygon = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// if boundary without hole, hole is null</span></span><br><span class="line">  <span class="keyword">repeated</span> BoundaryPolygon hole = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">RoadROIBoundary</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Id id = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">repeated</span> RoadBoundary road_boundaries = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// road section defines a road cross-section, At least one section must be defined in order to</span></span><br><span class="line"><span class="comment">// use a road, If multiple road sections are defined, they must be listed in order along the road</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">RoadSection</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Id id = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// lanes contained in this section</span></span><br><span class="line">  <span class="keyword">repeated</span> Id lane_id = <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// boundary of section</span></span><br><span class="line">  <span class="keyword">optional</span> RoadBoundary boundary = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The road is a collection of traffic elements, such as lanes, road boundary etc.</span></span><br><span class="line"><span class="comment">// It provides general information about the road.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Road</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Id id = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">repeated</span> RoadSection section = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// if lane road not in the junction, junction id is null.</span></span><br><span class="line">  <span class="keyword">optional</span> Id junction_id = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>车道Lane</p>
<figure class="highlight protobuf"><figcaption><span>modules/map/proto/mao_lane.proto</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">LaneBoundaryType</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">Type</span> </span>&#123;</span><br><span class="line">    UNKNOWN = <span class="number">0</span>;</span><br><span class="line">    DOTTED_YELLOW = <span class="number">1</span>;</span><br><span class="line">    DOTTED_WHITE = <span class="number">2</span>;</span><br><span class="line">    SOLID_YELLOW = <span class="number">3</span>;</span><br><span class="line">    SOLID_WHITE = <span class="number">4</span>;</span><br><span class="line">    DOUBLE_YELLOW = <span class="number">5</span>;</span><br><span class="line">    CURB = <span class="number">6</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// Offset relative to the starting point of boundary</span></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> s = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// support multiple types</span></span><br><span class="line">  <span class="keyword">repeated</span> Type types = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">LaneBoundary</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Curve curve = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> length = <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// indicate whether the lane boundary exists in real world</span></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">bool</span> virtual = <span class="number">3</span>;</span><br><span class="line">  <span class="comment">// in ascending order of s</span></span><br><span class="line">  <span class="keyword">repeated</span> LaneBoundaryType boundary_type = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Association between central point to closest boundary.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">LaneSampleAssociation</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> s = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> width = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A lane is part of a roadway, that is designated for use by a single line of vehicles.</span></span><br><span class="line"><span class="comment">// Most public roads (include highways) have more than two lanes.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Lane</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Id id = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Central lane as reference trajectory, not necessary to be the geometry central.</span></span><br><span class="line">  <span class="keyword">optional</span> Curve central_curve = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Lane boundary curve.</span></span><br><span class="line">  <span class="keyword">optional</span> LaneBoundary left_boundary = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">optional</span> LaneBoundary right_boundary = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// in meters.</span></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> length = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Speed limit of the lane, in meters per second.</span></span><br><span class="line">  <span class="keyword">optional</span> <span class="built_in">double</span> speed_limit = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">repeated</span> Id overlap_id = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// All lanes can be driving into (or from).</span></span><br><span class="line">  <span class="keyword">repeated</span> Id predecessor_id = <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">repeated</span> Id successor_id = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Neighbor lanes on the same direction.</span></span><br><span class="line">  <span class="keyword">repeated</span> Id left_neighbor_forward_lane_id = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">repeated</span> Id right_neighbor_forward_lane_id = <span class="number">11</span>;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">LaneType</span> </span>&#123;</span><br><span class="line">    NONE = <span class="number">1</span>;</span><br><span class="line">    CITY_DRIVING = <span class="number">2</span>;</span><br><span class="line">    BIKING = <span class="number">3</span>;</span><br><span class="line">    SIDEWALK = <span class="number">4</span>;</span><br><span class="line">    PARKING = <span class="number">5</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">optional</span> LaneType type = <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">LaneTurn</span> </span>&#123;</span><br><span class="line">    NO_TURN = <span class="number">1</span>;</span><br><span class="line">    LEFT_TURN = <span class="number">2</span>;</span><br><span class="line">    RIGHT_TURN = <span class="number">3</span>;</span><br><span class="line">    U_TURN = <span class="number">4</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">optional</span> LaneTurn turn = <span class="number">13</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">repeated</span> Id left_neighbor_reverse_lane_id = <span class="number">14</span>;</span><br><span class="line">  <span class="keyword">repeated</span> Id right_neighbor_reverse_lane_id = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">optional</span> Id junction_id = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Association between central point to closest boundary.</span></span><br><span class="line">  <span class="keyword">repeated</span> LaneSampleAssociation left_sample = <span class="number">17</span>;</span><br><span class="line">  <span class="keyword">repeated</span> LaneSampleAssociation right_sample = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">LaneDirection</span> </span>&#123;</span><br><span class="line">    FORWARD = <span class="number">1</span>;</span><br><span class="line">    BACKWARD = <span class="number">2</span>;</span><br><span class="line">    BIDIRECTION = <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">optional</span> LaneDirection direction = <span class="number">19</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Association between central point to closest road boundary.</span></span><br><span class="line">  <span class="keyword">repeated</span> LaneSampleAssociation left_road_sample = <span class="number">20</span>;</span><br><span class="line">  <span class="keyword">repeated</span> LaneSampleAssociation right_road_sample = <span class="number">21</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>路口Junction<br>对于路口区域的描述<br><figure class="highlight protobuf"><figcaption><span>modules/map/proto/map_junction.proto</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// An junction is the junction at-grade of two or more roads crossing.</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">Junction</span> </span>&#123;</span><br><span class="line">  <span class="keyword">optional</span> Id id = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">optional</span> Polygon polygon = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">repeated</span> Id overlap_id = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Proto格式地图的使用</p>
<p>这个时候的的地图格式，可以为Apollo中的多个模块，或者统一的方法所使用。</p>
<h2 id="获取高精地图元素"><a href="#获取高精地图元素" class="headerlink" title="获取高精地图元素"></a>获取高精地图元素</h2><h3 id="对地图的操作方法"><a href="#对地图的操作方法" class="headerlink" title="对地图的操作方法"></a>对地图的操作方法</h3><p>有了原始从xml格式到protobuf的数据之后，就可以访问这些高精地图的元素，Apollo高精地图提供如下的方法获取元素：<br><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">LoadMapFromFile (<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;map_filename) load <span class="built_in">map</span> from local file </span><br><span class="line">GetLaneById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetJunctionById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetSignalById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetCrosswalkById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetStopSignById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetYieldSignById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetClearAreaById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetSpeedBumpById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetOverlapById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetRoadById (<span class="keyword">const</span> Id &amp;id) <span class="keyword">const</span></span><br><span class="line">GetLanes (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; LaneInfoConstPtr &gt; *lanes) <span class="keyword">const</span></span><br><span class="line">    get all lanes in certain range More...</span><br><span class="line">GetJunctions (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; JunctionInfoConstPtr &gt; *junctions) <span class="keyword">const</span></span><br><span class="line">    get all junctions in certain range More...</span><br><span class="line">GetCrosswalks (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; CrosswalkInfoConstPtr &gt; *crosswalks) <span class="keyword">const</span></span><br><span class="line">    get all crosswalks in certain range More...</span><br><span class="line">GetSignals (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; SignalInfoConstPtr &gt; *signals) <span class="keyword">const</span></span><br><span class="line">    get all signals in certain range More...</span><br><span class="line">GetStopSigns (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; StopSignInfoConstPtr &gt; *stop_signs) <span class="keyword">const</span></span><br><span class="line">    get all stop signs in certain range More...</span><br><span class="line">GetYieldSigns (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; YieldSignInfoConstPtr &gt; *yield_signs) <span class="keyword">const</span></span><br><span class="line">    get all yield signs in certain range More...</span><br><span class="line">GetClearAreas (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; ClearAreaInfoConstPtr &gt; *clear_areas) <span class="keyword">const</span></span><br><span class="line">    get all clear areas in certain range More...</span><br><span class="line">GetSpeedBumps (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; SpeedBumpInfoConstPtr &gt; *speed_bumps) <span class="keyword">const</span></span><br><span class="line">    get all speed bumps in certain range More...</span><br><span class="line">GetRoads (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; RoadInfoConstPtr &gt; *roads) <span class="keyword">const</span></span><br><span class="line">    get all roads in certain range More...</span><br><span class="line">GetNearestLane (<span class="keyword">const</span> apollo::common::PointENU &amp;point, LaneInfoConstPtr *nearest_lane, <span class="keyword">double</span> *nearest_s, <span class="keyword">double</span> *nearest_l) <span class="keyword">const</span></span><br><span class="line">    get nearest lane from target point, More...</span><br><span class="line">GetNearestLaneWithHeading (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">const</span> <span class="keyword">double</span> distance, <span class="keyword">const</span> <span class="keyword">double</span> central_heading, <span class="keyword">const</span> <span class="keyword">double</span> max_heading_difference, LaneInfoConstPtr *nearest_lane, <span class="keyword">double</span> *nearest_s, <span class="keyword">double</span> *nearest_l) <span class="keyword">const</span></span><br><span class="line">    get the nearest lane within a certain range by pose More...</span><br><span class="line">GetLanesWithHeading (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">const</span> <span class="keyword">double</span> distance, <span class="keyword">const</span> <span class="keyword">double</span> central_heading, <span class="keyword">const</span> <span class="keyword">double</span> max_heading_difference, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; LaneInfoConstPtr &gt; *lanes) <span class="keyword">const</span></span><br><span class="line">    get all lanes within a certain range by pose More...</span><br><span class="line">GetRoadBoundaries (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">double</span> radius, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; RoadROIBoundaryPtr &gt; *road_boundaries, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; JunctionBoundaryPtr &gt; *junctions) <span class="keyword">const</span></span><br><span class="line">    get all road <span class="keyword">and</span> junctions boundaries within certain range More...</span><br><span class="line">GetForwardNearestSignalsOnLane (<span class="keyword">const</span> apollo::common::PointENU &amp;point, <span class="keyword">const</span> <span class="keyword">double</span> distance, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt; SignalInfoConstPtr &gt; *signals) <span class="keyword">const</span></span><br><span class="line">    get forward nearest signals within certain range on the lane <span class="keyword">if</span> there are two signals related to one stop line, <span class="keyword">return</span> both signals. More</span><br></pre></td></tr></table></figure></p>
<p>提供高精地图元素获取的方法实现类：<code>apollo::hdmap::HDMapImpl</code>，详见<a href="https://apolloauto.github.io/doxygen/apollo/classapollo_1_1hdmap_1_1HDMapImpl.html" target="_blank" rel="noopener">apollo::hdmap::HDMapImpl Class Reference</a></p>
<h3 id="获取元素实例"><a href="#获取元素实例" class="headerlink" title="获取元素实例"></a>获取元素实例</h3><figure class="highlight cpp"><figcaption><span>modules/planning/reference_line/reference_line_provider.cc</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">bool</span> ReferenceLineProvider::GetReferenceLinesFromRelativeMap(</span><br><span class="line">    <span class="keyword">const</span> relative_map::MapMsg &amp;relative_map,</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;ReferenceLine&gt; *reference_line,</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">list</span>&lt;hdmap::RouteSegments&gt; *segments) &#123;</span><br><span class="line">  <span class="keyword">if</span> (relative_map.navigation_path_size() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">auto</span> *hdmap = HDMapUtil::BaseMapPtr();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> path_pair : relative_map.navigation_path()) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;lane_id = path_pair.first;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;path_points = path_pair.second.path().path_point();</span><br><span class="line">    <span class="keyword">auto</span> lane_ptr = hdmap-&gt;GetLaneById(hdmap::MakeMapId(lane_id));</span><br><span class="line">    RouteSegments segment;</span><br><span class="line">    segment.emplace_back(lane_ptr, <span class="number">0.0</span>, lane_ptr-&gt;total_length());</span><br><span class="line">    segment.SetCanExit(<span class="literal">true</span>);</span><br><span class="line">    segment.SetId(lane_id);</span><br><span class="line">    segment.SetNextAction(routing::FORWARD);</span><br><span class="line">    segment.SetIsOnSegment(<span class="literal">true</span>);</span><br><span class="line">    segment.SetStopForDestination(<span class="literal">false</span>);</span><br><span class="line">    segment.SetPreviousAction(routing::FORWARD);</span><br><span class="line">    segments-&gt;emplace_back(segment);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;ReferencePoint&gt; ref_points;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;path_point : path_points) &#123;</span><br><span class="line">      ref_points.emplace_back(</span><br><span class="line">          MapPathPoint&#123;Vec2d&#123;path_point.x(), path_point.y()&#125;,</span><br><span class="line">                       path_point.theta(),</span><br><span class="line">                       LaneWaypoint(lane_ptr, path_point.s())&#125;,</span><br><span class="line">          path_point.kappa(), path_point.dkappa(), <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    reference_line-&gt;emplace_back(ref_points.begin(), ref_points.end());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用其他地图"><a href="#使用其他地图" class="headerlink" title="使用其他地图"></a>使用其他地图</h2><ol>
<li><p>更改全局 flagfile: <em><strong> modules/common/data/global_flagfile.txt </strong></em>这是所有模块的基本flag文件，保持了整体系统的统一。</p>
</li>
<li><p>作为flag标记传递，这样只影响单个进程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;binary&gt; --map_dir=/path/to/your/map</span><br></pre></td></tr></table></figure>
</li>
<li><p>覆盖模块所属的flag文件，生成位置：<br><em>modules/<module_name>/conf/<module_name>.conf</module_name></module_name></em><br>明显地，这个文件也只影响单个模块</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--flagfile=modules/common/data/global_flagfile.txt</span><br><span class="line"></span><br><span class="line"># Override values from the global flagfile.</span><br><span class="line">--map_dir=/path/to/your/map</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Question</p>
<ul>
<li>对于两条相连的路，可以用路口（junction)的概念描述，如果是桥梁的描述方式为？</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.opendrive.org/docs/OpenDRIVEFormatSpecRev1.4H.pdf" target="_blank" rel="noopener">OpenDRIVE® Format Specification, Rev. 1.4</a><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: OpenDRIVE节点
e=>end: Junction节点
op1=>condition: Header节点|current
op2=>start: Road节点
geo=>start: Geo Reference节点

st(right)->op1(no, right)->op2(right)->e
op1(yes)->geo</textarea><textarea id="flowchart-0-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">st=>start: OPENDRIVE XML
e=>end: Proto

st(right)->e</textarea><textarea id="flowchart-1-options" style="display: none">{"theme":"simple","scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script></li>
</ul>


<!--<a href="http://yoursite.com/apollo/module_hdmap.html#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'mickeyouyou'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=1254090228&web_id=1254090228" language="JavaScript"></script>script>
</div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->




</body>
</html>